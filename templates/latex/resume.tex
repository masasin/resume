\documentclass[<< theme.font_size >>, << theme.font_type >>, << theme.paper_size >>]{moderncv}

\usepackage{textcomp}
\usepackage{ifthen}
\usepackage{lastpage}

~< if engine == "pdflatex" >~
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
~< else >~
  \usepackage{xltxtra}
  \defaultfontfeatures{Scale=MatchLowercase, Mapping=tex-text, StylisticSet=5}
  \setmainfont{Libertinus Serif}
  \setromanfont{Libertinus Serif}
  \setsansfont{Libertinus Sans}
  \setmonofont{DejaVuSansMono Nerd Font Mono}
  % \usepackage{xeCJK}
  % \setCJKmainfont[BoldFont=Yu Mincho Extrabold]{YuMincho Medium}
  % \setCJKsansfont[BoldFont=Yu Gothic Bold]{YuGothic Medium}
  \usepackage{xunicode} % extra support for unicode
~< endif >~

\moderncvtheme[<< theme.colour >>]{<< theme.style >>}

\name{<< name.first >>}{<< name.last >>}
\title{<< title >>}

\email{<< contact.email >>}

~< if address is defined >~
\address%
    {<< address.street >>}%
    {<< address.post >> << address.city >>}%
    {~< if address.province is defined >~<< address.province >>~< endif >~~< if address.country is defined >~~<if address.province is defined >~, ~< endif >~<< address.country >>~< endif >~}
~< endif >~

~< if contact.mobile is defined >~
\mobile{<< contact.mobile >>}
~< endif >~

~< if contact.website is defined >~
\homepage{<< contact.website >>}
~< endif >~

~< if contact.github is defined >~
\social[github]{<< contact.github >>}
~< endif >~

~< if contact.linkedin is defined >~
\social[linkedin]{<< contact.linkedin >>}
~< endif >~

~< if extra_info is defined >~
\extrainfo{<< extra_info >>}
~< endif >~

~< if quote is defined >~
\quote{<< quote >>}
~< endif >~

~< if photo is defined >~
\photo~< if photo.size is defined >~[<< photo.size >>]~< endif >~{<< photo.path >>}
~< endif >~


\begin{document}

~< if business is defined >~
\rfoot{\ifthenelse{\value{page}=1}{}{\addressfont\itshape\textcolor{gray}{\thepage}}}
% Letter Information
\recipient{<< business.letter.addressee >>}{<<business.name.formal>> \\ << business.letter.address >>}
\date{\today}
\opening{~< if business.letter.greeting is defined >~<< business.letter.greeting >>~< else >~To whom it may concern,~< endif >~}
\closing{~< if business.letter.closing is defined >~<< business.letter.closing >>~< else >~Sincerely,~< endif >~}
\enclosure[Attached]{résumé} % List of enclosed documents

\makeatletter
\let\@extrainfo\relax       % Remove \@extrainfo
\patchcmd{\makeletterhead}  % <cmd>
  {\raggedright \@opening}  % <search>
  {\@opening}               % <replace>
  {}{}                      % <success><failure>
\makeatother
\makelettertitle            % Print letter title
<< business.body >>

\makeletterclosing          % Print letter signature
\newpage
\setcounter{page}{1}

  ~< if extra_info is defined >~
    \extrainfo{<< extra_info >>}
  ~< endif >~
~< endif >~

\rfoot{\addressfont\itshape\textcolor{gray}{\ifthenelse{\value{page}=1}{\\\small updated << updated >>}{\thepage\\\small updated << updated >>}}}

\makecvtitle
\vspace{-20pt}

<< body >>

\end{document}
